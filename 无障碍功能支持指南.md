# UIç»„ä»¶æ— éšœç¢åŠŸèƒ½æ”¯æŒæŒ‡å—

## ğŸ“‹ ç›®å½•
1. [ä»€ä¹ˆæ˜¯æ— éšœç¢åŠŸèƒ½ï¼Ÿ](#ä»€ä¹ˆæ˜¯æ— éšœç¢åŠŸèƒ½)
2. [ä¸ºä»€ä¹ˆéœ€è¦æ— éšœç¢æ”¯æŒï¼Ÿ](#ä¸ºä»€ä¹ˆéœ€è¦æ— éšœç¢æ”¯æŒ)
3. [å¦‚ä½•å®ç°æ— éšœç¢æ”¯æŒï¼Ÿ](#å¦‚ä½•å®ç°æ— éšœç¢æ”¯æŒ)
4. [ProgressBaræ— éšœç¢å®ç°ç¤ºä¾‹](#progressbaræ— éšœç¢å®ç°ç¤ºä¾‹)
5. [æµ‹è¯•æ— éšœç¢åŠŸèƒ½](#æµ‹è¯•æ— éšœç¢åŠŸèƒ½)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ä»€ä¹ˆæ˜¯æ— éšœç¢åŠŸèƒ½ï¼Ÿ

### ç®€å•ç†è§£
æ— éšœç¢åŠŸèƒ½å°±åƒç»™ç›²äººæœ‹å‹é…ä¸€ä¸ª"çœ¼ç›"ï¼Œè®©ä»–ä»¬ä¹Ÿèƒ½"çœ‹åˆ°"å’Œä½¿ç”¨æ‰‹æœºã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- **TalkBack**ï¼šå±å¹•é˜…è¯»å™¨ï¼Œæœ—è¯»å±å¹•ä¸Šçš„å†…å®¹
- **è¯­éŸ³è¾“å…¥**ï¼šé€šè¿‡è¯­éŸ³è¾“å…¥æ–‡å­—
- **æ”¾å¤§æ‰‹åŠ¿**ï¼šæ”¾å¤§å±å¹•å†…å®¹
- **é«˜å¯¹æ¯”åº¦**ï¼šæé«˜å¯¹æ¯”åº¦ï¼Œæ–¹ä¾¿è§†åŠ›ä¸å¥½çš„ç”¨æˆ·

### ä½¿ç”¨åœºæ™¯
- è§†éšœç”¨æˆ·ï¼šé€šè¿‡TalkBack"å¬"å±å¹•å†…å®¹
- å¬éšœç”¨æˆ·ï¼šé€šè¿‡è§†è§‰æç¤ºäº†è§£ä¿¡æ¯
- è¡ŒåŠ¨ä¸ä¾¿ç”¨æˆ·ï¼šé€šè¿‡è¯­éŸ³æ§åˆ¶æ‰‹æœº
- è€å¹´ç”¨æˆ·ï¼šé€šè¿‡æ”¾å¤§å’Œé«˜å¯¹æ¯”åº¦çœ‹æ¸…å†…å®¹

---

## ä¸ºä»€ä¹ˆéœ€è¦æ— éšœç¢æ”¯æŒï¼Ÿ

### æ³•å¾‹è¦æ±‚
- **ã€Šæ— éšœç¢ç¯å¢ƒå»ºè®¾æ³•ã€‹**ï¼šè¦æ±‚è½¯ä»¶æ”¯æŒæ— éšœç¢åŠŸèƒ½
- **Google Playè¦æ±‚**ï¼šåº”ç”¨å¿…é¡»æ”¯æŒæ— éšœç¢åŠŸèƒ½
- **ç³»ç»Ÿè¦æ±‚**ï¼šæ‰‹æœºç³»ç»Ÿå…¬å…±æ§ä»¶å¿…é¡»æ”¯æŒæ— éšœç¢

### ç”¨æˆ·ä½“éªŒ
- âœ… è®©æ›´å¤šç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨ä½ çš„åº”ç”¨
- âœ… æå‡åº”ç”¨çš„å¯è®¿é—®æ€§
- âœ… ç¬¦åˆå›½é™…æ ‡å‡†
- âœ… æå‡åº”ç”¨è¯„åˆ†

### æŠ€æœ¯ä¼˜åŠ¿
- âœ… æ›´å¥½çš„è¯­ä¹‰åŒ–
- âœ… æ›´å¥½çš„æµ‹è¯•æ”¯æŒ
- âœ… æ›´å¥½çš„è‡ªåŠ¨åŒ–æ”¯æŒ

---

## å¦‚ä½•å®ç°æ— éšœç¢æ”¯æŒï¼Ÿ

### æ ¸å¿ƒAPI

#### 1. ContentDescriptionï¼ˆå†…å®¹æè¿°ï¼‰

**ä½œç”¨ï¼š** å‘Šè¯‰å±å¹•é˜…è¯»å™¨è¿™ä¸ªViewæ˜¯ä»€ä¹ˆ

```java
// è®¾ç½®å†…å®¹æè¿°
view.setContentDescription("ç¡®å®šæŒ‰é’®");

// TalkBackä¼šæœ—è¯»ï¼š"ç¡®å®šæŒ‰é’®"
```

#### 2. AccessibilityNodeInfoï¼ˆæ— éšœç¢èŠ‚ç‚¹ä¿¡æ¯ï¼‰

**ä½œç”¨ï¼š** æä¾›Viewçš„è¯¦ç»†ä¿¡æ¯ç»™æ— éšœç¢æœåŠ¡

```java
ViewCompat.setAccessibilityDelegate(view, new AccessibilityDelegateCompat() {
    @Override
    public void onInitializeAccessibilityNodeInfo(View host, AccessibilityNodeInfoCompat info) {
        super.onInitializeAccessibilityNodeInfo(host, info);
        
        // è®¾ç½®è§’è‰²
        info.setClassName(Button.class.getName());
        
        // è®¾ç½®å†…å®¹æè¿°
        info.setContentDescription("ç¡®å®šæŒ‰é’®");
        
        // è®¾ç½®ä¸ºå¯è®¿é—®
        info.setAccessible(true);
    }
});
```

#### 3. AccessibilityEventï¼ˆæ— éšœç¢äº‹ä»¶ï¼‰

**ä½œç”¨ï¼š** å½“ViewçŠ¶æ€å˜åŒ–æ—¶ï¼Œé€šçŸ¥æ— éšœç¢æœåŠ¡

```java
// å‘é€å†…å®¹å˜åŒ–äº‹ä»¶
sendAccessibilityEvent(AccessibilityEvent.TYPE_WINDOW_CONTENT_CHANGED);

// å‘é€çŠ¶æ€å˜åŒ–äº‹ä»¶
sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_SELECTED);
```

### å®ç°æ­¥éª¤

#### æ­¥éª¤1ï¼šè®¾ç½®å†…å®¹æè¿°

```java
// æ–¹å¼1ï¼šåœ¨XMLä¸­è®¾ç½®
<Button
    android:contentDescription="ç¡®å®šæŒ‰é’®" />

// æ–¹å¼2ï¼šåœ¨ä»£ç ä¸­è®¾ç½®
button.setContentDescription("ç¡®å®šæŒ‰é’®");
```

#### æ­¥éª¤2ï¼šè®¾ç½®æ— éšœç¢ä»£ç†

```java
ViewCompat.setAccessibilityDelegate(view, new AccessibilityDelegateCompat() {
    @Override
    public void onInitializeAccessibilityNodeInfo(View host, AccessibilityNodeInfoCompat info) {
        super.onInitializeAccessibilityNodeInfo(host, info);
        // è‡ªå®šä¹‰æ— éšœç¢ä¿¡æ¯
    }
});
```

#### æ­¥éª¤3ï¼šå‘é€æ— éšœç¢äº‹ä»¶

```java
// å½“çŠ¶æ€å˜åŒ–æ—¶å‘é€äº‹ä»¶
sendAccessibilityEvent(AccessibilityEvent.TYPE_WINDOW_CONTENT_CHANGED);
```

---

## ProgressBaræ— éšœç¢å®ç°ç¤ºä¾‹

### CustomProgressBaræ— éšœç¢æ”¯æŒ

**å·²å®ç°çš„åŠŸèƒ½ï¼š**

1. **å†…å®¹æè¿°**
   - è‡ªåŠ¨ç”Ÿæˆæè¿°ï¼š"çº¿æ€§è¿›åº¦æ¡ï¼Œå½“å‰è¿›åº¦50%"
   - æ”¯æŒè‡ªå®šä¹‰æè¿°

2. **è¿›åº¦ä¿¡æ¯**
   - è®¾ç½®è¿›åº¦èŒƒå›´ï¼ˆ0-100ï¼‰
   - è®¾ç½®å½“å‰è¿›åº¦å€¼
   - æ”¯æŒTalkBackæœ—è¯»è¿›åº¦

3. **çŠ¶æ€æ›´æ–°**
   - è¿›åº¦å˜åŒ–æ—¶è‡ªåŠ¨å‘é€äº‹ä»¶
   - é€šçŸ¥å±å¹•é˜…è¯»å™¨æ›´æ–°

**ä»£ç å®ç°ï¼š**

```java
private void initAccessibility() {
    ViewCompat.setAccessibilityDelegate(this, new AccessibilityDelegateCompat() {
        @Override
        public void onInitializeAccessibilityNodeInfo(View host, AccessibilityNodeInfoCompat info) {
            super.onInitializeAccessibilityNodeInfo(host, info);
            
            // è®¾ç½®è§’è‰²ä¸ºè¿›åº¦æ¡
            info.setClassName(android.widget.ProgressBar.class.getName());
            
            // è®¾ç½®è¿›åº¦ä¿¡æ¯
            int progressPercent = (int) (currentProgress * 100);
            info.setProgressInfo(
                AccessibilityNodeInfoCompat.RangeInfoCompat.obtain(
                    AccessibilityNodeInfoCompat.RangeInfoCompat.RANGE_TYPE_INT,
                    0f, 100f, (float) progressPercent, 1f
                )
            );
            
            // è®¾ç½®å†…å®¹æè¿°
            String contentDesc = getAccessibilityContentDescription();
            if (contentDesc != null && !contentDesc.isEmpty()) {
                info.setContentDescription(contentDesc);
            } else {
                String modeText = progressMode == MODE_LINEAR ? "çº¿æ€§" : "ç¯å½¢";
                info.setContentDescription(String.format("%sè¿›åº¦æ¡ï¼Œå½“å‰è¿›åº¦%d%%", modeText, progressPercent));
            }
            
            info.setAccessible(true);
        }
    });
    
    ViewCompat.setImportantForAccessibility(this, ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_YES);
}
```

### ä½¿ç”¨ç¤ºä¾‹

```java
CustomProgressBar progressBar = findViewById(R.id.progress_bar);

// æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤æè¿°
progressBar.setProgress(0.5f);
// TalkBackä¼šæœ—è¯»ï¼š"çº¿æ€§è¿›åº¦æ¡ï¼Œå½“å‰è¿›åº¦50%"

// æ–¹å¼2ï¼šè‡ªå®šä¹‰æè¿°
progressBar.setAccessibilityContentDescription("æ–‡ä»¶ä¸‹è½½è¿›åº¦ï¼Œå½“å‰50%");
// TalkBackä¼šæœ—è¯»ï¼š"æ–‡ä»¶ä¸‹è½½è¿›åº¦ï¼Œå½“å‰50%"
```

---

## æµ‹è¯•æ— éšœç¢åŠŸèƒ½

### 1. å¯ç”¨TalkBack

**æ­¥éª¤ï¼š**
1. æ‰“å¼€"è®¾ç½®"
2. æ‰¾åˆ°"æ— éšœç¢"æˆ–"è¾…åŠ©åŠŸèƒ½"
3. å¼€å¯"TalkBack"
4. æŒ‰ç…§æç¤ºå®Œæˆè®¾ç½®

### 2. æµ‹è¯•æ–¹æ³•

#### æ–¹æ³•1ï¼šæ‰‹åŠ¨æµ‹è¯•
1. å¯ç”¨TalkBack
2. æ»‘åŠ¨å±å¹•ï¼Œè®©TalkBackèšç„¦åˆ°ä½ çš„ç»„ä»¶
3. å¬TalkBackæœ—è¯»çš„å†…å®¹
4. æ£€æŸ¥å†…å®¹æ˜¯å¦å‡†ç¡®

#### æ–¹æ³•2ï¼šä½¿ç”¨AccessibilityScanner
1. å®‰è£…Googleçš„AccessibilityScanneråº”ç”¨
2. è¿è¡Œåº”ç”¨
3. æ‰«ææ— éšœç¢é—®é¢˜
4. æŸ¥çœ‹æŠ¥å‘Š

#### æ–¹æ³•3ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•
```java
@Test
public void testAccessibility() {
    AccessibilityNodeInfoCompat nodeInfo = 
        ViewCompat.getAccessibilityNodeInfo(progressBar);
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹æè¿°
    assertNotNull("ç¼ºå°‘å†…å®¹æè¿°", nodeInfo.getContentDescription());
    
    // æ£€æŸ¥æ˜¯å¦å¯è®¿é—®
    assertTrue("Viewä¸å¯è®¿é—®", nodeInfo.isAccessible());
    
    // æ£€æŸ¥è¿›åº¦ä¿¡æ¯
    AccessibilityNodeInfoCompat.RangeInfoCompat rangeInfo = 
        nodeInfo.getRangeInfo();
    assertNotNull("ç¼ºå°‘è¿›åº¦ä¿¡æ¯", rangeInfo);
}
```

### 3. æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰äº¤äº’å…ƒç´ éƒ½æœ‰å†…å®¹æè¿°
- [ ] è¿›åº¦æ¡èƒ½æ­£ç¡®æœ—è¯»è¿›åº¦å€¼
- [ ] çŠ¶æ€å˜åŒ–æ—¶å‘é€æ— éšœç¢äº‹ä»¶
- [ ] è‡ªå®šä¹‰Viewè®¾ç½®äº†æ­£ç¡®çš„è§’è‰²
- [ ] é‡è¦Viewè®¾ç½®ä¸ºå¯è®¿é—®
- [ ] æµ‹è¯•TalkBackæœ—è¯»æ˜¯å¦å‡†ç¡®

---

## æœ€ä½³å®è·µ

### 1. å†…å®¹æè¿°è§„èŒƒ

**å¥½çš„æè¿°ï¼š**
- âœ… "ç¡®å®šæŒ‰é’®"
- âœ… "æ–‡ä»¶ä¸‹è½½è¿›åº¦ï¼Œå½“å‰50%"
- âœ… "æœç´¢æ¡†ï¼Œè¯·è¾“å…¥å…³é”®è¯"

**ä¸å¥½çš„æè¿°ï¼š**
- âŒ "æŒ‰é’®"ï¼ˆå¤ªæ¨¡ç³Šï¼‰
- âŒ "View123"ï¼ˆæ— æ„ä¹‰ï¼‰
- âŒ ""ï¼ˆç©ºæè¿°ï¼‰

### 2. è§’è‰²è®¾ç½®

**å¸¸ç”¨è§’è‰²ï¼š**
```java
// æŒ‰é’®
info.setClassName(Button.class.getName());

// è¿›åº¦æ¡
info.setClassName(ProgressBar.class.getName());

// è¾“å…¥æ¡†
info.setClassName(EditText.class.getName());

// å›¾ç‰‡
info.setClassName(ImageView.class.getName());
```

### 3. äº‹ä»¶å‘é€æ—¶æœº

**åº”è¯¥å‘é€äº‹ä»¶çš„æƒ…å†µï¼š**
- âœ… è¿›åº¦å€¼å˜åŒ–
- âœ… çŠ¶æ€æ”¹å˜ï¼ˆé€‰ä¸­/æœªé€‰ä¸­ï¼‰
- âœ… å†…å®¹æ›´æ–°
- âœ… å¯è§æ€§å˜åŒ–

**ä¸åº”è¯¥å‘é€äº‹ä»¶çš„æƒ…å†µï¼š**
- âŒ å¸ƒå±€å˜åŒ–ï¼ˆç³»ç»Ÿè‡ªåŠ¨å¤„ç†ï¼‰
- âŒ åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼ˆé¿å…é¢‘ç¹äº‹ä»¶ï¼‰

### 4. æ€§èƒ½è€ƒè™‘

- âœ… é¿å…åœ¨onDrawä¸­æ›´æ–°æ— éšœç¢ä¿¡æ¯
- âœ… ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è®¡ç®—
- âœ… æ‰¹é‡æ›´æ–°æ—¶åˆå¹¶äº‹ä»¶

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè®¾ç½®äº†contentDescriptionï¼ŒTalkBackè¿˜æ˜¯ä¸æœ—è¯»ï¼Ÿ

**ç­”æ¡ˆï¼š** å¯èƒ½çš„åŸå› ï¼š
1. Viewè¢«è®¾ç½®ä¸º`IMPORTANT_FOR_ACCESSIBILITY_NO`
2. Viewçš„çˆ¶å®¹å™¨é˜»æ­¢äº†æ— éšœç¢è®¿é—®
3. TalkBackæ²¡æœ‰å¯ç”¨

**è§£å†³æ–¹æ³•ï¼š**
```java
// è®¾ç½®ä¸ºé‡è¦
ViewCompat.setImportantForAccessibility(view, ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_YES);
```

### Q2: å¦‚ä½•æµ‹è¯•æ— éšœç¢åŠŸèƒ½ï¼Ÿ

**ç­”æ¡ˆï¼š** 
1. å¯ç”¨TalkBackæ‰‹åŠ¨æµ‹è¯•
2. ä½¿ç”¨AccessibilityScanneræ‰«æ
3. ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹

### Q3: è‡ªå®šä¹‰Viewå¦‚ä½•è®¾ç½®è§’è‰²ï¼Ÿ

**ç­”æ¡ˆï¼š** åœ¨AccessibilityDelegateä¸­è®¾ç½®ï¼š
```java
info.setClassName(ç›¸ä¼¼çš„æ ‡å‡†Viewç±».getName());
// ä¾‹å¦‚ï¼šè¿›åº¦æ¡ç”¨ProgressBarï¼ŒæŒ‰é’®ç”¨Button
```

---

## æ€»ç»“

### æ— éšœç¢æ”¯æŒè¦ç‚¹

1. âœ… **å†…å®¹æè¿°**ï¼šæ‰€æœ‰äº¤äº’å…ƒç´ éƒ½è¦æœ‰æè¿°
2. âœ… **è§’è‰²è®¾ç½®**ï¼šè®¾ç½®æ­£ç¡®çš„Viewè§’è‰²
3. âœ… **äº‹ä»¶é€šçŸ¥**ï¼šçŠ¶æ€å˜åŒ–æ—¶å‘é€äº‹ä»¶
4. âœ… **å¯è®¿é—®æ€§**ï¼šç¡®ä¿Viewå¯ä»¥è¢«è®¿é—®
5. âœ… **æµ‹è¯•éªŒè¯**ï¼šä½¿ç”¨TalkBackæµ‹è¯•

### å®ç°æ­¥éª¤

1. åœ¨init()æ–¹æ³•ä¸­è°ƒç”¨initAccessibility()
2. è®¾ç½®AccessibilityDelegate
3. åœ¨çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°æ— éšœç¢ä¿¡æ¯
4. å‘é€æ— éšœç¢äº‹ä»¶
5. æµ‹è¯•éªŒè¯

---

**é€šè¿‡æ·»åŠ æ— éšœç¢æ”¯æŒï¼Œå¯ä»¥è®©æ›´å¤šç”¨æˆ·ä½¿ç”¨ä½ çš„ç»„ä»¶ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼** â™¿

